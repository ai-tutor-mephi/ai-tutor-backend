# AI Tutor Backend API - Документация для Frontend
Этот документ описывает API для взаимодействия с бэкендом проекта AI Tutor.

## 1. Общая информация
- **Базовый URL:** `http://localhost:8080` (для локальной разработки)
- **Формат данных:** Все тела запросов и ответов используют формат `application\json`, если не указано иное.
- **Аутентификация:** Все эндпоинты, кроме `"/api/auth/register", "/api/auth/login", "/api/auth/refresh"`, требуют аутентификации. Для этого необходимо передавать JWT-токен в заголовке `Authorization`.
    - **Формат заголовка:** `Authorization: Bearer <jwt_токен>`

## 2. Аутентификация

Эндпоинты для регистрации и входа в систему.

### 2.1. Регистрация нового пользователя

Создает нового пользователя в системе.

- **Эндпоинт:** `POST /api/auth/register`
- **Тип запроса:** `application/json`
- **Тело запроса:**
  ```json  
  {  
    "userName": "testuser",    
    "email": "user@example.com",    
    "password": "testpassword"  
  }  
    ```

### 2.2. Вход нового пользователя  

Авторизация пользователя, у которого уже существует аккаунт.

- **Эндпоинт:** `POST /api/auth/login`  
- **Тип запроса:** `application/json`  
- **Тело запроса:**  
```json  
{  
    "userName": "testuser",      
    "password": "testpassword"  
}  
```
- **Ответ:**
```json
  {
	  "access_token": "...",
	  "refresh_token": "..."
  }
 ```
access_token представляет собой JWT, живет 15 минут, refresh живет 30 дней.
Как с этим работать? Refresh нужно куда-то сохранить на стороне фронта, например, в localStorage или в httpOnly cookie , на стороне бэка он хранится в бд. Access_token используется для аутентификации при запросах. По истечении его срока годности при попытке доступа к эндпоинту, который требует авторизации, а это все эндпоинты /api/auth/**, возвращается **401 Unauthorized**, на стороне фронтенда она попадает в обработчик ошибок, фронтенд берет refreshToken из localStorage и обращается к эндпоинту POST /api/auth/refresh, получая новую пару токенов, если срок refresh токена истек, то нужно заново логинится, в ответ придет 403 Forbidden.

### 2.3. Получение новой пары токенов

**Эндпоинт:** `POST /api/auth/refresh`
- **Тип запроса:** `application/json`
- **Тело запроса:**
```json
{
	"refreshToken": "..."
}
```
- **Ответ:**
  ```json
  {
	  "accessToken": "...",
	  "refreshToken": "..."
  }
  ```

### 2.4. Выход пользователя из аккаунта

Делает текущий refreshToken недействительным. Требует наличия валидного accessToken для идентификации пользователя.

- **Эндпоинт:** `POST /api/auth/logout`
- **Тип запроса:** `application/json`
- **Тело запроса:** empty
- **Ответ:** 200 OK, Тело: "User logged out successfully!"

## 3. Диалоги

### 3.1. Создание нового диалога с файлом или файлами

Загружает первый файл и создает на его основе новый диалог.
- **Эндпоинт:** `POST /api/dialogs/with-files`
- **Описание:** Загружает файлы и создает на их основе новый диалог, название диалога совпадает с названием первого загруженного файла.
- **Тип запроса:** `multipart/form-data`
- **Тело запроса:** Поле с ключом files и типом File.
- **Успешный ответ (201 Created):**
    ```json
    {
      "dialogId": 1,
      "title": "имя_диалога.pdf"
    }
    ```
- **Ошибки:**
    - 413 Payload Too Large (если файл превышает лимит).
    - 500 Internal Server Error (если произошла ошибка при сохранении).

### 3.2. Добавление файла или файлов в существующий диалог

Загружает дополнительные файлы в контекст существующего диалога.
- **Эндпоинт:** `POST /api/dialogs/{dialogId}/files`
- **Тип запроса:** `multipart/form-data`
- **Тело запроса:** Поле с ключом files и типом File.
- **Успешный ответ (201 Created):**
    ```json
    {
      "fileId": 101,
      "originalFileName": "дополнительный_файл.docx",
      "dialogId": 1
    }
    ```
- **Ошибки:**
    - 404 Not Found (если диалог с dialogId не найден).
    - 403 Forbidden (если диалог не принадлежит текущему пользователю).

### 3.3. Получение списка диалогов пользователя

Возвращает отсортированный по дате (сначала новые) список всех диалогов, принадлежащих текущему пользователю.
- **Эндпоинт:** `GET /api/dialogs`
- **Успешный ответ (200 OK):** Массив объектов.
```json
[ 
	{ 
		"dialogId": 2,
		"title": "Обсуждение курсовой.docx",
		"createdAt": "2023-10-28T12:00:00Z" 
	}, 
	{ 
		"dialogId": 1,
		"title": "Годовой отчет.pdf", 
		"createdAt": "2023-10-27T15:30:00Z" 
	} 
]
```

### 3.4. Получение всех файлов в диалоге

Возвращает метаданные о файлах в диалоге по ID диалога.
- **Эндпоинт:** `GET /api/dialogs/{dialogId}/files`
- **Успешный ответ (200 OK):** Массив объектов.
```json
[ 
    { 
        "dialogId": 2,
        "title": "Обсуждение курсовой.docx",
        "createdAt": "2023-10-28T12:00:00Z" 
    }, 
    { 
        "dialogId": 1,
        "title": "Годовой отчет.pdf", 
        "createdAt": "2023-10-27T15:30:00Z" 
    } 
]
```

### 3.5. Удаление диалога

Удаляет диалог, а также все связанные с ним файлы (в MinIO) и сообщения (в БД).
- **Эндпоинт:** `DELETE /api/dialogs/{dialogId}`
    - {dialogId} - ID удаляемого диалога.
- **Успешный ответ:** 204 No Content
- **Ошибки:**
    - 404 Not Found (если диалог не найден).
    - 403 Forbidden (если диалог не принадлежит текущему пользователю).

### 3.6. Отправка сообщения

Отправка сообщения в диалог
- **Эндпоинт:** `POST /api/dialogs/{dialogId}/send-question`
	- {dialogId} - ID диалога, в который отправляется сообщение.
- **Тип запроса:** `application/json` 
- **Тело запроса**
  ```json
  {
  "question": "..."
  }
  ```
- **Успешный ответ (200 OK):**
    ```json
    {
      "answer": "..."
    }
    ```
- **Ошибки:**
    - Сделаю позже